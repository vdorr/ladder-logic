<html>
<head>
<meta charset="utf-8"/>
	<script type="text/javascript">


class Environment {
	constructor() {
		this.m = {};
		this.states = [];
	}
	run() {
		return true;
	}
	get(name) {
		console.log("1");
		return this.m[name];
	}
	set(name, value) {
		this.m[name] = value;
		console.log("2");
	}
	scan_begin() {
//TODO copy values from ins to outs
		console.log("3");
	}
	scan_end() {
//TODO copy values from outs to ins
		console.log("4");
	}
	add_st(name, value) {
		this.states.push(name);
		this.m["in " + name] = value;
		this.m["out " + name] = value;
		console.log("5 " + name);
	}
	add_tmp(name, value) {
		this.m[name] = value;
		console.log("6 " + name);
	}
}

function compile() {
	const src = document.getElementById("tasrc").value;
	const escaped_src = encodeURIComponent(src);
	console.log(escaped_src);

	var xhr = new XMLHttpRequest();
	xhr.open('GET', 'http://localhost:3000/compile?src=' + escaped_src, true);
// 	xhr.open('GET', 'http://excellentlizard.herokuapp.com/compile?src=' + escaped_src, true);

	xhr.onload = function () {
	// Request finished. Do processing here.
		console.log("done");
        var rsp = JSON.parse(this.responseText);
        console.log(rsp.failure);
        console.log(rsp.artifact);

//just test it, store it somewhere... later
		env = new Environment();
        eval(rsp.artifact)


//		eval(this.responseText);
	};

	console.log("sending");
	xhr.send();

}

    </script>
</head>
<body>
    <div>

<textarea rows="24" cols="48" id="tasrc">
(* --- test 04 --- *)

| %MX0  %MX1        %MX1
+--[/]---[/]---------(S)-
| %MX0  %MX1  %MX0  %MX1
+--[/]---[ ]---(S)---(R)-
| %MX0  %MX1        %MX1
+--[ ]---[/]---------(S)-
| %MX0  %MX1  %MX0  %MX1
+--[ ]---[ ]---(R)---(R)-
|
</textarea>

<textarea rows="24" cols="48" id="response">
</textarea>
    </div>

<button onclick="compile();">hello</button>
<input type="checkbox" name="id_sim_run" value="">run</input>

</body>

